<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}.site-title{font-family:Neucha,cursive;}</style><style data-href="/styles.131b48b25a50eff60b34.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.31.1"/><title data-react-helmet="true">ToLookup vs. GroupBy | Tripping on Code</title><meta data-react-helmet="true" name="description" content="GroupBy and ToLookup methods are two methods found as extensions to IEnumerable on the System.Linq namespace seems to perform very similar operations. The main…"/><meta data-react-helmet="true" property="og:title" content="ToLookup vs. GroupBy"/><meta data-react-helmet="true" property="og:description" content="GroupBy and ToLookup methods are two methods found as extensions to IEnumerable on the System.Linq namespace seems to perform very similar operations. The main…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Avinash"/><meta data-react-helmet="true" name="twitter:title" content="ToLookup vs. GroupBy"/><meta data-react-helmet="true" name="twitter:description" content="GroupBy and ToLookup methods are two methods found as extensions to IEnumerable on the System.Linq namespace seems to perform very similar operations. The main…"/><link href="//fonts.googleapis.com/css?family=Neucha:|Merriweather:400,400i,700,700i,900,900i" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/webpack-runtime-22aae9bfc4acc394ad09.js"/><link as="script" rel="preload" href="/framework-8aba4025690a031b46dc.js"/><link as="script" rel="preload" href="/styles-755093da0c07f4b49226.js"/><link as="script" rel="preload" href="/app-d6503d8fb02dc710753b.js"/><link as="script" rel="preload" href="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-1a550ea69d7a36947cb6.js"/><link as="script" rel="preload" href="/cd7d5f864fc9e15ed8adef086269b0aeff617554-1a9f40c15a3a5b7c91ac.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-ffbf4ac3ca223927147b.js"/><link as="fetch" rel="preload" href="/page-data/group-by-vs-to-lookup/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/426816048.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:63rem;padding:2.625rem 1.3125rem"><header><h3 class="site-title" style="margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Tripping on Code</a></h3></header><main><h1 style="margin-top:1.75rem;margin-bottom:0">ToLookup vs. GroupBy</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">January 31, 2021</p><div><p>GroupBy and ToLookup methods are two methods found as extensions to <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ienumerable-1?view=net-5.0" target="_blank" rel="nofollow">IEnumerable<T></a> on the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq" target="_blank" rel="nofollow">System.Linq</a> namespace seems to perform very similar operations. The main difference between them is that GroupBy performs deferred execution while ToLookup performs immediate execution. Take a look at the example below for more details.</p>
<h2>The Setup</h2>
<p>Let us create a record to hold our data type.</p>
<div class="gatsby-highlight" data-language="csharp"><pre style="counter-reset: linenumber NaN" class="language-csharp line-numbers"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">record</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> firstName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> lastName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> country<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">firstName</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">lastName</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">country</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Then let’s set up a method to return a new Person object.</p>
<div class="gatsby-highlight" data-language="csharp"><pre style="counter-reset: linenumber NaN" class="language-csharp line-numbers"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Person<span class="token punctuation">></span></span> <span class="token function">GetPersons</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
     <span class="token class-name"><span class="token keyword">var</span></span> firstNameRandomizer <span class="token operator">=</span> RandomizerFactory<span class="token punctuation">.</span><span class="token function">GetRandomizer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FieldOptionsFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name"><span class="token keyword">var</span></span> lastNameRandomizer <span class="token operator">=</span> RandomizerFactory<span class="token punctuation">.</span><span class="token function">GetRandomizer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FieldOptionsLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name"><span class="token keyword">var</span></span> countryRandomizer <span class="token operator">=</span> RandomizerFactory<span class="token punctuation">.</span><span class="token function">GetRandomizer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FieldOptionsCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
          <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span><span class="token punctuation">(</span>
              <span class="token named-parameter punctuation">firstName</span><span class="token punctuation">:</span> firstNameRandomizer<span class="token punctuation">.</span><span class="token function">Generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token named-parameter punctuation">lastName</span><span class="token punctuation">:</span> lastNameRandomizer<span class="token punctuation">.</span><span class="token function">Generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token named-parameter punctuation">country</span><span class="token punctuation">:</span> countryRandomizer<span class="token punctuation">.</span><span class="token function">Generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The GetPersons method is an <a href="https://docs.microsoft.com/en-us/dotnet/csharp/iterators" target="_blank" rel="nofollow">iterator</a> that will return as many persons as requested by the caller. </p>
<p>Note: We are using the <a href="https://www.nuget.org/packages/RandomDataGenerator.Net/" target="_blank" rel="nofollow">RandomDataGenerator.Net</a> package to generate random names and countries.</p>
<h2>The differences</h2>
<h3>Superficial Differences</h3>
<p>Let’s try executing the above method with both GroupBy and ToLookup</p>
<div class="gatsby-highlight" data-language="csharp"><pre style="counter-reset: linenumber NaN" class="language-csharp line-numbers"><code class="language-csharp"><span class="token comment">// ToLookup</span>
<span class="token class-name">ILookup<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Person<span class="token punctuation">></span></span> lookupResult <span class="token operator">=</span> <span class="token function">GetPersons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLookup</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>country<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// GroupBy</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>IGrouping<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Person<span class="token punctuation">></span><span class="token punctuation">></span></span> groupResult <span class="token operator">=</span> <span class="token function">GetPersons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>country<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The ToLookup method returns an ILookup&#x3C;string, Person>. An <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.ilookup-2?view=net-5.0" target="_blank" rel="nofollow">ILookup&#x3C;TKey, TValue></a> is very similar to a dictionary with one huge exception. A dictionary requires that a single key has a single value, while an ILookup maps a key to multiple values. So running <code class="language-text">groupResult[&quot;United Kingdom&quot;]</code> returns an IEnumerable<Person> containing all the people living in the United Kingdom. </p>
<p>The GroupBy method, on the other hand, returns an IEnumerable&#x3C;IGrouping&#x3C;string, Person>>. An <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.igrouping-2?view=net-5.0" target="_blank" rel="nofollow">IGrouping&#x3C;TKey, TValue></a> also maps a single key to multiple values. However, we cannot use the indexer to find the value. If you want all the people who live in the UK, you will have to do the following.</p>
<div class="gatsby-highlight" data-language="csharp"><pre style="counter-reset: linenumber NaN" class="language-csharp line-numbers"><code class="language-csharp"><span class="token class-name">IGrouping<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Person<span class="token punctuation">></span></span> ukPeople <span class="token operator">=</span> groupResult<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>Key <span class="token operator">==</span> <span class="token string">"United Kingdom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>ukPeople is a collection that will contain all the people living in the United Kingdom. It has a property called Key, which includes the Key used to group these results. The United Kingdom, in this case.</p>
<h3>Immediate Execution vs. Deferred Execution</h3>
<p>The main difference is how they are executed. ToLookup is very similar to ToList, ToDictionary, or ToArray. The result is materialized immediately, and you can start working on the items. In the case of GroupBy, the result is only materialized when a method like ToList or ToArray is invoked.</p>
<p>This becomes a factor when we are dealing with either Entity Framework or dealing with generator functions that return large datasets. </p>
<p>ToLookup will pause all execution until the entire list is processed. GroupBy will only be processed as we loop through the result or invoke ToList.</p>
<h4>Entity Framework and Deferred Execution</h4>
<p>The difference between ToLookup and GroupBy are very easily explained when looking at Entity Framework.</p>
<p>Let’s take a look at the following expression</p>
<div class="gatsby-highlight" data-language="csharp"><pre style="counter-reset: linenumber NaN" class="language-csharp line-numbers"><code class="language-csharp"><span class="token comment">// Query 1</span>
<span class="token class-name"><span class="token keyword">var</span></span> peopleInUkByGender <span class="token operator">=</span> dbContext<span class="token punctuation">.</span>People<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>Country <span class="token operator">==</span> <span class="token string">"UK"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>Gender<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Query 2</span>
<span class="token class-name"><span class="token keyword">var</span></span> peopleInUkByGender <span class="token operator">=</span> dbContext<span class="token punctuation">.</span>People<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>Country <span class="token operator">==</span> <span class="token string">"UK"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLookup</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>Gender<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The above code gets translated into (rougly) the following SQL statements</p>
<div class="gatsby-highlight" data-language="sql"><pre style="counter-reset: linenumber NaN" class="language-sql line-numbers"><code class="language-sql"><span class="token comment"># Query 1</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> People
<span class="token keyword">WHERE</span> Country <span class="token operator">=</span> <span class="token string">'UK'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Gender

<span class="token comment"># Query 2</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> People
<span class="token keyword">WHERE</span> Country <span class="token operator">=</span> <span class="token string">'UK'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>For Query 1, the grouping is done in the database server.
For Query 2, the grouping is done in memory by looping through the entire dataset.</p>
<h3>Which should I use?</h3>
<p>There are many factors that should be taken into consideration when making such a decision, but I can provide a general rule here that could work well.</p>
<p>When dealing with IEnumerable<T> or IQueryable<T>, use ToDictionary. An IEnumerable indicates the possibility of deferred execution, therefore it makes sense to use GroupBy.</p>
<p>When dealing with Lists, Collections, Dictionary, Hashsets or any other type that requires the data to be materialized, use ToLookup. It’s easier to use and the syntax is cleaner.</p></div><hr style="margin-bottom:1.75rem"/><div style="display:flex;margin-bottom:4.375rem;align-items:center"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABucJVIssUbMQA/8QAGRABAAMBAQAAAAAAAAAAAAAAAgEDEgAE/9oACAEBAAEFAmjv12SSBsMxq5751wVmF0zmqnz12V//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAdEAACAgIDAQAAAAAAAAAAAAAAAQIRAxIhIjGB/9oACAEBAAY/Asab7IVRsjLeuPCOV/RLF3S9ordDT8qxSRtKPJ//xAAdEAACAgIDAQAAAAAAAAAAAAABEQAhMUFRYZHB/9oACAEBAAE/IRxBl+Tcdbg3htGIcxTDEICHu7RBCs3DMOTQo7lWOFx9gowXc//aAAwDAQACAAMAAAAQl+89/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPxBiK//EAB4QAQACAgMAAwAAAAAAAAAAAAERIQAxQWGBUXGR/9oACAEBAAE/EDSSMSC1zguxZmwETXzN5CmEkPnePDIYRoisglII1OKq95SumzuL13J5iw5gJkh164gyzBlfR0/cllC2V1n/2Q==" alt="Avinash" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/e1d64d61f374d5ed905adb660931101b/99438/profile-pic.jpg 1x,
/static/e1d64d61f374d5ed905adb660931101b/aba1d/profile-pic.jpg 1.5x,
/static/e1d64d61f374d5ed905adb660931101b/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/e1d64d61f374d5ed905adb660931101b/99438/profile-pic.jpg 1x,
/static/e1d64d61f374d5ed905adb660931101b/aba1d/profile-pic.jpg 1.5x,
/static/e1d64d61f374d5ed905adb660931101b/b315d/profile-pic.jpg 2x" src="/static/e1d64d61f374d5ed905adb660931101b/99438/profile-pic.jpg" alt="Avinash" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p style="margin-bottom:0">Written by <strong>Avinash</strong>.<!-- --> <a href="https://twitter.com/avi1989">You should follow him on Twitter</a></p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/early-returns-vs-single-return/">← <!-- -->Early Returns</a></li><li></li></ul></main><footer>© <!-- -->2022<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/group-by-vs-to-lookup/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-0eca59d2ee8c0828e3a6.js"],"app":["/app-d6503d8fb02dc710753b.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b0556ce5127c1a3e2490.js"],"component---src-pages-404-js":["/component---src-pages-404-js-443b9414fd7616b09644.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f40d181b3139000ada9e.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-ffbf4ac3ca223927147b.js"]};/*]]>*/</script><script src="/polyfill-0eca59d2ee8c0828e3a6.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-ffbf4ac3ca223927147b.js" async=""></script><script src="/cd7d5f864fc9e15ed8adef086269b0aeff617554-1a9f40c15a3a5b7c91ac.js" async=""></script><script src="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-1a550ea69d7a36947cb6.js" async=""></script><script src="/app-d6503d8fb02dc710753b.js" async=""></script><script src="/styles-755093da0c07f4b49226.js" async=""></script><script src="/framework-8aba4025690a031b46dc.js" async=""></script><script src="/webpack-runtime-22aae9bfc4acc394ad09.js" async=""></script></body></html>